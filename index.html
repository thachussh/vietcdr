<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Công cụ Tạo Rubric</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React CDN -->
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <!-- Babel for JSX -->
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.20.6/babel.min.js"></script>
</head>
<body class="bg-gray-100">
  <div id="root" className="container mx-auto p-4"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    const App = () => {
      const [criteria, setCriteria] = useState([
        { name: "", levels: ["", "", "", ""] },
      ]);
      const [title, setTitle] = useState("Tiêu chí đánh giá");
      const [description, setDescription] = useState("Mô tả rubric...");
      const [levelLabels, setLevelLabels] = useState(["Xuất sắc", "Tốt", "Đạt", "Chưa đạt"]);

      const addCriterion = () => {
        setCriteria([...criteria, { name: "", levels: ["", "", "", ""] }]);
      };

      const updateCriterion = (index, field, value) => {
        const newCriteria = [...criteria];
        if (field === "name") {
          newCriteria[index].name = value;
        } else {
          newCriteria[index].levels[field] = value;
        }
        setCriteria(newCriteria);
      };

      const updateLevelLabel = (index, value) => {
        const newLabels = [...levelLabels];
        newLabels[index] = value;
        setLevelLabels(newLabels);
      };

      const exportToHTML = () => {
        try {
          const htmlContent = `
            <html>
              <head>
                <meta charset="UTF-8">
                <style>
                  body { font-family: Arial, sans-serif; }
                  h1 { font-size: 24px; font-weight: bold; }
                  p { font-size: 16px; }
                  table { width: 100%; border-collapse: collapse; }
                  th, td { border: 1px solid black; padding: 8px; text-align: left; }
                  th { background-color: #f2f2f2; }
                </style>
              </head>
              <body>
                <h1>${title}</h1>
                <p>${description}</p>
                <table>
                  <thead>
                    <tr>
                      <th>Tiêu chí</th>
                      ${levelLabels.map(label => `<th>${label}</th>`).join('')}
                    </tr>
                  </thead>
                  <tbody>
                    ${criteria.map(criterion => `
                      <tr>
                        <td>${criterion.name}</td>
                        ${criterion.levels.map(level => `<td>${level}</td>`).join('')}
                      </tr>
                    `).join('')}
                  </tbody>
                </table>
              </body>
            </html>
          `;
          const blob = new Blob([htmlContent], { type: 'text/html' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = 'rubric.html';
          a.click();
          URL.revokeObjectURL(url);
          console.log("Tải file HTML thành công!");
        } catch (error) {
          console.error("Lỗi khi xuất file HTML:", error);
          alert("Đã có lỗi xảy ra khi xuất file HTML. Vui lòng kiểm tra console để biết thêm chi tiết.");
        }
      };

      const exportToTXT = () => {
        try {
          let txtContent = `${title}\n\n${description}\n\n`;
          txtContent += `Tiêu chí\t${levelLabels.join('\t')}\n`;
          criteria.forEach(criterion => {
            txtContent += `${criterion.name}\t${criterion.levels.join('\t')}\n`;
          });
          const blob = new Blob([txtContent], { type: 'text/plain' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = 'rubric.txt';
          a.click();
          URL.revokeObjectURL(url);
          console.log("Tải file TXT thành công!");
        } catch (error) {
          console.error("Lỗi khi xuất file TXT:", error);
          alert("Đã có lỗi xảy ra khi xuất file TXT. Vui lòng kiểm tra console để biết thêm chi tiết.");
        }
      };

      const exportToJSON = () => {
        try {
          const jsonContent = JSON.stringify({
            title,
            description,
            levelLabels,
            criteria
          }, null, 2);
          const blob = new Blob([jsonContent], { type: 'application/json' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = 'rubric.json';
          a.click();
          URL.revokeObjectURL(url);
          console.log("Tải file JSON thành công!");
        } catch (error) {
          console.error("Lỗi khi xuất file JSON:", error);
          alert("Đã có lỗi xảy ra khi xuất file JSON. Vui lòng kiểm tra console để biết thêm chi tiết.");
        }
      };

      return (
        <div className="bg-white p-6 rounded-lg shadow-md">
          <h1 className="text-2xl font-bold mb-4">Công cụ Tạo Rubric</h1>
          
          <div className="mb-4">
            <label className="block text-sm font-medium text-gray-700">Tiêu đề:</label>
            <input
              type="text"
              value={title}
              onChange={(e) => setTitle(e.target.value)}
              className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"
            />
          </div>

          <div className="mb-4">
            <label className="block text-sm font-medium text-gray-700">Mô tả:</label>
            <textarea
              value={description}
              onChange={(e) => setDescription(e.target.value)}
              className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"
              rows="3"
            />
          </div>

          <div className="mb-4">
            <label className="block text-sm font-medium text-gray-700">Nhãn mức độ:</label>
            <div className="grid grid-cols-4 gap-2">
              {levelLabels.map((label, index) => (
                <input
                  key={index}
                  type="text"
                  value={label}
                  onChange={(e) => updateLevelLabel(index, e.target.value)}
                  className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"
                />
              ))}
            </div>
          </div>

          <div className="mb-4">
            <label className="block text-sm font-medium text-gray-700">Tiêu chí:</label>
            {criteria.map((criterion, index) => (
              <div key={index} className="mb-4 p-4 border rounded-md">
                <input
                  type="text"
                  placeholder="Tên tiêu chí"
                  value={criterion.name}
                  onChange={(e) => updateCriterion(index, "name", e.target.value)}
                  className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm mb-2"
                />
                <div className="grid grid-cols-4 gap-2">
                  {criterion.levels.map((level, levelIndex) => (
                    <textarea
                      key={levelIndex}
                      placeholder={`Mô tả ${levelLabels[levelIndex]}`}
                      value={level}
                      onChange={(e) => updateCriterion(index, levelIndex, e.target.value)}
                      className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"
                      rows="2"
                    />
                  ))}
                </div>
              </div>
            ))}
            <button
              onClick={addCriterion}
              className="mt-2 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
            >
              Thêm tiêu chí
            </button>
          </div>

          <div className="mt-4 space-x-2">
            <button
              onClick={exportToHTML}
              className="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
            >
              Xuất HTML
            </button>
            <button
              onClick={exportToTXT}
              className="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500"
            >
              Xuất TXT
            </button>
            <button
              onClick={exportToJSON}
              className="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500"
            >
              Xuất JSON
            </button>
          </div>
        </div>
      );
    };

    ReactDOM.render(<App />, document.getElementById("root"));
  </script>
</body>
</html>